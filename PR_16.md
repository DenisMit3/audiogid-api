# PR 16: Commons Media Ingestion (Stage 3)

## CONTEXT PACK
A) **Nonâ€‘negotiables**: RU-only; on-device Whisper only; **server-confirm only**; **offline-first**; **NO STUBS**; **validation via Preview/Prod URLs**.
B) **Current scope**:
    *   Enhance Wikidata client to fetch Commons metadata (License, Author).
    *   Update Process for rigorous storage of attribution.
    *   Ensure `PoiMedia` contains valid `license_type` (CC-BY-SA, Public Domain) and `author`.
    *   Refuse ingestion if license is missing or incompatible (fail-safe).
C) **Interfaces in play**: `PoiMedia` table, `wikidata.py`.
D) **Async reminder**: Part of Ingestion Job.

## Implementation Plan
1.  **Service Update**:
    *   Update `apps/api/api/core/ingestion/wikidata.py`:
        *   Request `extmetadata` from Commons API.
        *   Parse `LicenseShortName`, `Artist` (html stripped), `LicenseUrl`.
2.  **Processor Update**:
    *   Update `apps/api/api/core/ingestion/processor.py`:
        *   Map metadata to `PoiMedia` fields.
        *   Filter out restricted licenses (if any logic needed).
3.  **Admin Update**:
    *   Update `admin_tours.py` -> `list_pois` to include media in output for verification.

## Verification
*   **Cloud**: Trigger ingestion.
*   **Check**: `GET /admin/pois` -> inspect `media` list for "CC BY-SA 4.0" etc.

## Rollback
*   Revert PR.
