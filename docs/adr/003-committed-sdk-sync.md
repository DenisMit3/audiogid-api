# ADR-003: Включение сгенерированного SDK в репозиторий и принудительная синхронизация в CI

## Статус
Принято

## Контекст
Согласно `POLICY.md`, проект Audio Guide 2026 следует подходу OpenAPI-first. Это требует наличия актуального SDK для мобильного клиента, который синхронизирован с бэкендом.

## Решение
1. Сгенерированный Dart SDK располагается в директории `packages/api_client`.
2. Код SDK **обязательно** фиксируется (commit) в репозитории. Это позволяет мобильному клиенту использовать SDK без необходимости запуска генератора на своей стороне.
3. CI/CD пайплайн (`.github/workflows/api-contract-sync.yaml`) выполняет проверку `fail-on-diff`:
   - На каждом PR пайплайн заново генерирует SDK из канонического `apps/api/openapi.yaml`.
   - Если сформированный код отличается от того, что был закоммичен, билд падает с ошибкой.

## Последствия
- Разработчики бэкенда обязаны перегенерировать SDK при любом изменении контракта.
- Гарантируется, что мобильное приложение всегда использует типы и эндпоинты, соответствующие серверной спецификации.
- Чистота репозитория поддерживается автоматическим контролем рассинхронизации.

## Изменение порядка работы
При отклонении PR по причине рассинхронизации клиентского кода, разработчик должен выполнить команду генерации локально и закоммитить изменения в ту же ветку.
