-- Связываем существующие POI с туром
-- Используем существующие POI из базы данных

-- 1. Удаляем старые связи (если есть)
DELETE FROM tour_items WHERE tour_id = 'b2000001-0000-0000-0000-000000000001';

-- 2. Создаем связи тура с существующими POI
INSERT INTO tour_items (id, tour_id, poi_id, order_index, transition_text_ru, duration_seconds)
VALUES
    (gen_random_uuid(), 'b2000001-0000-0000-0000-000000000001', 'a1000001-0000-0000-0000-000000000001', 0, 'Начните маршрут у главного входа. Купите билеты и возьмите карту зоопарка.', 600),
    (gen_random_uuid(), 'b2000001-0000-0000-0000-000000000001', 'a1000001-0000-0000-0000-000000000002', 1, 'Пройдите к вольеру бенгальских тигров.', 900),
    (gen_random_uuid(), 'b2000001-0000-0000-0000-000000000001', 'a1000001-0000-0000-0000-000000000003', 2, 'Посетите контактную площадку - отличное место для детей!', 900),
    (gen_random_uuid(), 'b2000001-0000-0000-0000-000000000001', 'a1000001-0000-0000-0000-000000000004', 3, 'Пройдите в ботанический сад Амазония.', 900),
    (gen_random_uuid(), 'b2000001-0000-0000-0000-000000000001', 'a1000001-0000-0000-0000-000000000005', 4, 'Посмотрите на жирафов - можно покормить!', 900),
    (gen_random_uuid(), 'b2000001-0000-0000-0000-000000000001', 'a1000001-0000-0000-0000-000000000006', 5, 'Завершите маршрут в обезьяннике.', 1200);

-- 3. Проверяем результат
SELECT t.id, t.title_ru, t.description_ru, t.cover_image, t.distance_km, t.tour_type,
       (SELECT COUNT(*) FROM tour_items ti WHERE ti.tour_id = t.id) as poi_count
FROM tour t
WHERE t.id = 'b2000001-0000-0000-0000-000000000001';

-- 4. Проверяем связи
SELECT ti.order_index, p.title_ru, ti.transition_text_ru
FROM tour_items ti
JOIN poi p ON ti.poi_id = p.id
WHERE ti.tour_id = 'b2000001-0000-0000-0000-000000000001'
ORDER BY ti.order_index;
